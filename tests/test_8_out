randperm_nodes tensor([ 4, 14, 19,  0,  1,  8,  2, 15,  3, 17, 13, 11, 10, 16,  9,  7,  5, 18,
        12,  6], dtype=torch.int32)


after fill_buckets_FIFO
hash_indices_nodes tensor([[0, 3, 1, 3],
        [1, 3, 1, 3],
        [0, 0, 2, 2],
        [2, 3, 2, 2],
        [0, 1, 3, 1],
        [1, 1, 2, 3],
        [1, 1, 2, 1],
        [3, 1, 2, 3],
        [2, 2, 1, 2],
        [3, 2, 0, 2],
        [2, 2, 3, 0],
        [1, 1, 2, 1],
        [0, 1, 3, 0],
        [0, 2, 2, 1],
        [2, 3, 2, 0],
        [0, 0, 2, 0],
        [2, 3, 1, 0],
        [3, 2, 0, 2],
        [1, 1, 3, 2],
        [2, 2, 3, 1]], dtype=torch.int32)
buckets tensor([[[13,  2,  4, 12],
         [ 1,  5,  6, 18],
         [19, 10, 16, 14],
         [ 7,  9, 17, -1]],

        [[ 2, 15, -1, -1],
         [18,  5,  6,  7],
         [19, 13,  9, 17],
         [14,  1,  3, 16]],

        [[ 9, 17, -1, -1],
         [ 0,  1, 16, -1],
         [ 7, 13, 14,  6],
         [19, 10, 12, 18]],

        [[10, 12, 16, 14],
         [ 4,  6, 13, 19],
         [ 2, 18,  8, 17],
         [ 0,  1,  5,  7]]], dtype=torch.int32)
bucket_counts tensor([[5, 4, 5, 3],
        [2, 5, 5, 5],
        [2, 4, 7, 5],
        [4, 4, 6, 4]], dtype=torch.int32)


after fill_buckets_FIFO_2
hash_indices_nodes tensor([[0, 3, 1, 3],
        [1, 3, 1, 3],
        [0, 0, 2, 2],
        [2, 3, 2, 2],
        [0, 1, 3, 1],
        [1, 1, 2, 3],
        [1, 1, 2, 1],
        [3, 1, 2, 3],
        [2, 2, 1, 2],
        [3, 2, 0, 2],
        [2, 2, 3, 0],
        [1, 1, 2, 1],
        [0, 1, 3, 0],
        [0, 2, 2, 1],
        [2, 3, 2, 0],
        [0, 0, 2, 0],
        [2, 3, 1, 0],
        [3, 2, 0, 2],
        [1, 1, 3, 2],
        [2, 2, 3, 1]], dtype=torch.int32)
buckets tensor([[[12,  4,  0, 15],
         [ 1,  5, 18,  6],
         [ 8, 14,  3, 16],
         [ 7,  9, -1, -1]],

        [[ 2, 15, -1, -1],
         [12,  6,  5, 18],
         [13,  8, 17,  9],
         [14, 16,  1, -1]],

        [[ 9, -1, -1, -1],
         [ 0, 16, -1, -1],
         [ 6,  5, 15,  3],
         [ 4, 18, 12, -1]],

        [[15, 12, 16, -1],
         [ 4, 19,  6, -1],
         [ 8,  2,  3,  9],
         [ 0,  1, -1, -1]]], dtype=torch.int32)
bucket_counts tensor([[5, 4, 4, 2],
        [2, 6, 4, 2],
        [1, 2, 5, 3],
        [3, 3, 4, 2]], dtype=torch.int32)


after fill_buckets_FIFO_3
hash_indices_nodes tensor([[0, 3, 1, 3],
        [1, 3, 1, 3],
        [0, 0, 2, 2],
        [2, 3, 2, 2],
        [0, 1, 3, 1],
        [1, 1, 2, 3],
        [1, 1, 2, 1],
        [3, 1, 2, 3],
        [2, 2, 1, 2],
        [3, 2, 0, 2],
        [2, 2, 3, 0],
        [1, 1, 2, 1],
        [0, 1, 3, 0],
        [0, 2, 2, 1],
        [2, 3, 2, 0],
        [0, 0, 2, 0],
        [2, 3, 1, 0],
        [3, 2, 0, 2],
        [1, 1, 3, 2],
        [2, 2, 3, 1]], dtype=torch.int32)
buckets tensor([[[ 0,  2,  4, 13],
         [11, 18, -1, -1],
         [10,  3, 14, -1],
         [ 7,  9, -1, -1]],

        [[ 2, -1, -1, -1],
         [ 4, 18,  7, -1],
         [10,  8,  9, -1],
         [ 0, 16, 14, -1]],

        [[ 9, -1, -1, -1],
         [16,  8, -1, -1],
         [ 2,  3, 13, 14],
         [ 4, 18, 19, -1]],

        [[15, 12, 14, -1],
         [ 4, 13, -1, -1],
         [ 8,  9, -1, -1],
         [ 5,  7, -1, -1]]], dtype=torch.int32)
bucket_counts tensor([[3, 2, 3, 2],
        [1, 1, 3, 3],
        [2, 2, 4, 1],
        [3, 1, 2, 3]], dtype=torch.int32)


after fill_buckets_FIFO_4
hash_indices_nodes tensor([[0, 3, 1, 3],
        [1, 3, 1, 3],
        [0, 0, 2, 2],
        [2, 3, 2, 2],
        [0, 1, 3, 1],
        [1, 1, 2, 3],
        [1, 1, 2, 1],
        [3, 1, 2, 3],
        [2, 2, 1, 2],
        [3, 2, 0, 2],
        [2, 2, 3, 0],
        [1, 1, 2, 1],
        [0, 1, 3, 0],
        [0, 2, 2, 1],
        [2, 3, 2, 0],
        [0, 0, 2, 0],
        [2, 3, 1, 0],
        [3, 2, 0, 2],
        [1, 1, 3, 2],
        [2, 2, 3, 1]], dtype=torch.int32)
buckets tensor([[[13, 15,  4, 12],
         [18,  5,  6, 11],
         [16, 19, 10, 14],
         [ 7,  9, 17, -1]],

        [[ 2, 15, -1, -1],
         [11, 12, 18,  7],
         [17, 19, 10, 13],
         [16,  1,  3, 14]],

        [[ 9, 17, -1, -1],
         [ 0,  1,  8, 16],
         [15, 11, 13, 14],
         [19, 10, 12, 18]],

        [[16, 12, 14, 15],
         [19,  6, 11, 13],
         [17, 18,  8,  9],
         [ 0,  1,  5,  7]]], dtype=torch.int32)
bucket_counts tensor([[6, 5, 6, 3],
        [2, 7, 6, 5],
        [2, 4, 9, 5],
        [5, 5, 6, 4]], dtype=torch.int32)


after fill_buckets_reservoir_sampling
hash_indices_nodes tensor([[0, 3, 1, 3],
        [1, 3, 1, 3],
        [0, 0, 2, 2],
        [2, 3, 2, 2],
        [0, 1, 3, 1],
        [1, 1, 2, 3],
        [1, 1, 2, 1],
        [3, 1, 2, 3],
        [2, 2, 1, 2],
        [3, 2, 0, 2],
        [2, 2, 3, 0],
        [1, 1, 2, 1],
        [0, 1, 3, 0],
        [0, 2, 2, 1],
        [2, 3, 2, 0],
        [0, 0, 2, 0],
        [2, 3, 1, 0],
        [3, 2, 0, 2],
        [1, 1, 3, 2],
        [2, 2, 3, 1]], dtype=torch.int32)
buckets tensor([[[13,  2,  4, 15],
         [ 1,  5, 18, -1],
         [ 3, 16, 19, -1],
         [17,  9, -1, -1]],

        [[ 2, 15, -1, -1],
         [ 4,  5, 18, 12],
         [17, 19,  9, -1],
         [ 0,  1,  3, 16]],

        [[17,  9, -1, -1],
         [ 0,  1, 16,  8],
         [13, 14, 15, 11],
         [ 4, 10, 18, 19]],

        [[15, 12, 14, -1],
         [ 4, 11, 19, -1],
         [ 2,  3,  8,  9],
         [ 0,  1,  5,  7]]], dtype=torch.int32)
bucket_counts tensor([[6, 3, 4, 2],
        [2, 3, 2, 5],
        [2, 4, 7, 4],
        [3, 3, 4, 4]], dtype=torch.int32)


after fill_buckets_reservoir_sampling_2
hash_indices_nodes tensor([[0, 3, 1, 3],
        [1, 3, 1, 3],
        [0, 0, 2, 2],
        [2, 3, 2, 2],
        [0, 1, 3, 1],
        [1, 1, 2, 3],
        [1, 1, 2, 1],
        [3, 1, 2, 3],
        [2, 2, 1, 2],
        [3, 2, 0, 2],
        [2, 2, 3, 0],
        [1, 1, 2, 1],
        [0, 1, 3, 0],
        [0, 2, 2, 1],
        [2, 3, 2, 0],
        [0, 0, 2, 0],
        [2, 3, 1, 0],
        [3, 2, 0, 2],
        [1, 1, 3, 2],
        [2, 2, 3, 1]], dtype=torch.int32)
buckets tensor([[[ 0, 13,  4, 15],
         [ 1,  5,  6, 18],
         [16,  8, 10, 19],
         [ 7,  9, 17, -1]],

        [[ 2, 15, -1, -1],
         [ 4,  5, 11, 18],
         [ 8, 19, 17, 13],
         [ 0,  1,  3, 14]],

        [[ 9, 17, -1, -1],
         [ 0,  1,  8, 16],
         [11,  3, 13, 14],
         [19, 10, 12, 18]],

        [[10, 12, 14, 15],
         [ 4,  6, 19, 13],
         [ 2,  3,  8, 17],
         [ 0,  1,  5,  7]]], dtype=torch.int32)
bucket_counts tensor([[6, 5, 6, 3],
        [2, 7, 6, 5],
        [2, 4, 9, 5],
        [5, 5, 6, 4]], dtype=torch.int32)


sampled_nodes tensor([[ 2,  2, 18, 17,  8, 11, 13, 13, 11,  6,  8,  8, 15,  7, 11,  9,  5, 11,
         14,  4],
        [ 0,  6,  2,  5, 11,  9,  4, 15, 13,  9,  6,  9,  6,  6,  1, 12, 17,  7,
         15,  5],
        [15, 14, 18, 14, 17,  6,  4,  0, 14, 17, 11, 11,  2,  5,  8,  8, 19,  6,
         15, 12],
        [ 8,  0, 18,  0,  6, 19, 16,  6,  1, 13, 14,  4, 11,  0, 17, 13,  5,  3,
          1, 16]], dtype=torch.int32)
presample_counts tensor([1, 1, 0, 2], dtype=torch.int32)
after sample_nodes_vanilla
sampled_nodes tensor([[ 2,  7,  9, 17,  4,  5, 11, 18,  0,  1,  8, 16, 10, 12, 14, 15,  3, 13,
          6, 19],
        [ 0, 13,  4, 15,  1,  3, 14,  8, 16, 10, 12, 18,  6, 19,  2, 17, 11,  9,
          7,  5],
        [ 0, 13,  4, 15,  5, 11, 18,  3, 14, 10, 12,  2, 17, 16,  9,  7,  6, 19,
          1,  8],
        [ 8,  0,  7,  9, 17,  2, 15, 19, 10, 12, 18,  1,  5,  6,  4, 14,  3, 13,
         11, 16]], dtype=torch.int32)
presample_counts tensor([1, 1, 0, 2], dtype=torch.int32)
hash_indices_batch tensor([[3, 1, 1, 0],
        [0, 3, 1, 0],
        [0, 1, 2, 0],
        [3, 0, 3, 3]], dtype=torch.int32)


sampled_nodes tensor([[17,  0, 16, 10,  7,  9,  4,  5, 11, 18,  1,  8, 12, 14, 15,  6, 19,  2,
          3, 13],
        [ 4,  3,  0, 13, 15,  1, 14,  8, 16, 10, 12,  7,  5, 18,  6, 19,  2, 17,
         11,  9],
        [15, 13, 12,  0,  4,  5, 11, 18,  3, 14, 10,  2, 17, 16,  9,  7,  6, 19,
          1,  8],
        [ 6,  7,  9, 17,  2, 15, 19, 10, 12, 18,  0,  1,  5, 16,  4, 14,  8,  3,
         13, 11]], dtype=torch.int32)
presample_counts tensor([4, 2, 3, 1], dtype=torch.int32)
after sample_nodes_vanilla_2
sampled_nodes tensor([[17,  0, 16, 10,  7,  9,  4,  5, 11, 18,  1,  8, 12, 14, 15,  6, 19,  2,
          3, 13],
        [ 4,  3,  0, 13, 15,  1, 14,  8, 16, 10, 12,  7,  5, 18,  6, 19,  2, 17,
         11,  9],
        [15, 13, 12,  0,  4,  5, 11, 18,  3, 14, 10,  2, 17, 16,  9,  7,  6, 19,
          1,  8],
        [ 6,  7,  9, 17,  2, 15, 19, 10, 12, 18,  0,  1,  5, 16,  4, 14,  8,  3,
         13, 11]], dtype=torch.int32)
presample_counts tensor([4, 2, 3, 1], dtype=torch.int32)
hash_indices_batch tensor([[3, 1, 1, 0],
        [0, 3, 1, 0],
        [0, 1, 2, 0],
        [3, 0, 3, 3]], dtype=torch.int32)


sampled_nodes tensor([[ 1,  7,  9, 17,  4,  5, 11, 18,  0,  8, 16, 10, 12, 14, 15, 13,  6, 19,
          2,  3],
        [ 6, 10,  0, 13,  4, 15,  1,  3, 14,  8, 16, 12, 17, 11,  9,  7,  5, 18,
         19,  2],
        [ 0, 13,  4, 15,  5, 11, 18,  3, 14, 10, 12, 19,  1,  8,  2, 17, 16,  9,
          7,  6],
        [ 9,  2,  5,  2,  7, 17, 15, 19, 10, 12, 18,  0,  1,  8,  3, 13, 11, 16,
          6,  4]], dtype=torch.int32)
presample_counts tensor([1, 2, 0, 4], dtype=torch.int32)
after sample_nodes_vanilla_3
sampled_nodes tensor([[ 1,  7,  9, 17,  4,  5, 11, 18,  0,  8, 16, 10, 12, 14, 15, 13,  6, 19,
          2,  3],
        [ 6, 10,  0, 13,  4, 15,  1,  3, 14,  8, 16, 12, 17, 11,  9,  7,  5, 18,
         19,  2],
        [ 0, 13,  4, 15,  5, 11, 18,  3, 14, 10, 12, 19,  1,  8,  2, 17, 16,  9,
          7,  6],
        [ 9,  2,  5,  2,  7, 17, 15, 19, 10, 12, 18,  0,  1,  8,  3, 13, 11, 16,
          6,  4]], dtype=torch.int32)
presample_counts tensor([1, 2, 0, 4], dtype=torch.int32)
hash_indices_batch tensor([[3, 1, 1, 0],
        [0, 3, 1, 0],
        [0, 1, 2, 0],
        [3, 0, 3, 3]], dtype=torch.int32)
